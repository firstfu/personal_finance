# 豆芽可愛化重設計

**日期:** 2026-02-18
**方案:** 方案 A — 全面 SpriteKit 重繪
**目標:** 將豆芽養成功能從寫實植物風格改為可愛盆栽寵物風格，參考發票怪獸的夢幻可愛氛圍，並加入音效和背景音樂。

---

## 1. 可愛盆栽角色

### 1.1 花盆（PotNode）

- **造型:** 圓潤陶瓷花盆，用貝茲曲線繪製，比現有梯形花盆更圓更可愛
- **顏色:** 溫暖的珊瑚粉/奶油色系，與品牌綠色互補
- **腮紅:** 兩個淡粉色圓形在眼睛下方，永遠存在
- **表情系統:** 花盆上有兩個圓形眼睛（SKShapeNode）和一個弧形嘴巴
  - **開心:** 彎彎的笑眼 + 微笑弧線（記帳後/澆水時）
  - **期待:** 圓圓大眼 + 小嘴（一般狀態）
  - **睡覺:** 閉眼 + "zzZ"（今天已澆水後的閒置狀態）
  - **驚喜:** 大眼 + O 嘴（階段提升時）

### 1.2 豆芽植物（PlantNode 重繪）

| 階段 | 造型 | 可愛元素 |
|------|------|---------|
| 0 種子 | 花盆裡的小種子，微微發光 | 種子上有小裂縫，偶爾微微跳動 |
| 1 發芽 | 一根小芽冒出，帶兩片圓形子葉 | 子葉會像小手一樣擺動 |
| 2 小苗 | 較高的莖 + 3-4 片圓潤葉子 | 葉子更大更圓，偶爾展開像伸懶腰 |
| 3 茂盛 | 飽滿的灌木造型 + 小花苞 | 搖擺幅度更大，像在跳舞 |
| 4 開花 | 頂部一朵大花 + 周圍小花 | 花瓣會旋轉，散發愛心粒子 |

### 1.3 閒置動畫

- 花盆微微左右搖擺（像呼吸）
- 植物隨風輕微擺動
- 偶爾眨眼（每 3-5 秒）
- 階段 4 時花瓣緩慢旋轉

---

## 2. 背景場景

### 2.1 漸層色彩

| 階段 | 上方色 | 下方色 | 氛圍 |
|------|--------|--------|------|
| 0 種子 | 淡粉 `#FFE4E1` | 奶油 `#FFF8DC` | 溫暖黎明 |
| 1 發芽 | 淡紫粉 `#E8D5F5` | 淡綠 `#E8F5E9` | 清新早晨 |
| 2 小苗 | 淡藍 `#E0F0FF` | 薄荷綠 `#C8E6C9` | 晴朗白天 |
| 3 茂盛 | 粉紫 `#F3E5F5` | 淡金 `#FFF9C4` | 魔法午後 |
| 4 開花 | 玫瑰金 `#FFE0E6` | 淡橘 `#FFE0B2` | 金色黃昏 |

### 2.2 裝飾元素（SKShapeNode 程式繪製）

- **雲朵:** 2-3 朵小圓雲（多個圓形組合），緩慢左右飄移
- **光點:** 閃爍的小圓點，散佈在背景中
- **花瓣飄落:** 階段 3-4 時，粉色小花瓣從上方緩緩飄落（粒子效果）
- **地面:** 圓潤的綠色草地小山丘，上面有小花朵裝飾

### 2.3 粒子效果升級

| 效果 | 現有 | 新版 |
|------|------|------|
| 澆水 | 白色水滴 | 藍色水滴 + 小水花濺起 |
| 成長 | 綠色光點 | 彩色星星 + 愛心混合 |
| 階段提升 | 金色爆發 | 彩虹色紙花 + 大星星 |
| 環境 | 綠色微光 | 多色柔和光點 + 小蝴蝶 |

---

## 3. 音效與音樂系統

### 3.1 架構：AudioService

新建 `AudioService` 類別（@MainActor），使用 `AVAudioEngine` 作為核心。

```
AudioService (class, @MainActor)
├── AVAudioEngine        — 音頻引擎
├── AVAudioPlayerNode    — 音效播放器
├── AVAudioSourceNode    — 合成器（波形生成）
├── BGM 控制             — 迴圈播放背景音樂
├── 音量控制             — 分別控制音效/音樂音量
└── 開關                 — @AppStorage 持久化設定
```

### 3.2 音效清單（程式合成，8-bit 可愛風）

| 音效 | 描述 | 合成方式 |
|------|------|---------|
| `waterDrop` | 清脆的水滴聲 | 高頻正弦波下滑 (800Hz→200Hz, 0.3s) |
| `grow` | 歡快的上升音 | 三角波上滑 (300Hz→600Hz, 0.4s) |
| `stageUp` | 勝利小旋律 | Do-Mi-Sol 三連音（每音 0.15s） |
| `harvest` | 慶祝音效 | 琶音上行 + 輕微混響 (0.8s) |
| `tap` | 可愛的「咕」聲 | 短促正弦波 (400Hz, 0.1s) + 快速衰減 |
| `blink` | 極輕的「咻」 | 極短白噪音過濾 (0.05s) |

### 3.3 背景音樂（BGM）

- 用 `AVAudioSourceNode` 合成 8-bit 風格迴圈旋律
- 溫馨的 C 大調音階，BPM 約 80，4 小節迴圈
- 方波 + 三角波混合，音色類似 GameBoy 但更柔和
- 音量預設 0.3，不會蓋過音效

### 3.4 設定整合

在設定頁面新增：
- **音效開關** — `@AppStorage("soundEffectsEnabled")` 預設開啟
- **音樂開關** — `@AppStorage("backgroundMusicEnabled")` 預設開啟

---

## 4. 互動系統

### 4.1 輕拍互動

| 互動 | 動畫 | 音效 |
|------|------|------|
| 輕拍花盆 | 花盆左右搖晃 + 表情變開心 | `tap` 咕聲 |
| 輕拍植物 | 葉子彈跳 + 冒出 1-2 個愛心粒子 | `tap` 咕聲 |
| 快速連拍 3 次 | 花盆跳起來 + 大量星星粒子 | `tap` x3 + 歡快音 |
| 長按 | 花盆臉紅（腮紅變深）+ 冒愛心 | 柔和的嗯聲 |

### 4.2 說話泡泡

輕拍時隨機顯示文字泡泡（SKLabelNode + 背景氣泡形狀）：
- 一般：「嗨嗨~」「好開心」「再來一次~」「謝謝澆水」「好想長大」
- 階段 4：「我開花了耶!」「好漂亮~」

---

## 5. UI 改版

### 5.1 SproutTabView 改版

保持 ScrollView 結構，視覺風格全面可愛化：

1. **SpriteView 區域** — 接近全寬，圓角 32pt，柔和陰影
2. **角色名稱標籤** — 「我的小豆芽」+ 等級標籤 (Lv 0 ~ Lv 4)
3. **進度條** — 圓潤膠囊形狀，填充色用階段對應漸層
4. **統計卡片** — 圓角更大，可愛小圖標
5. **今日狀態** — 已澆水：花盆睡覺表情 + 「今天已澆水囉~」
6. **收成按鈕** — 加大，夢幻漸層色，微光動畫

### 5.2 澆水動畫流程

1. t=0s：下雨粒子（藍色水滴）+ 澆水音效
2. t=0.5s：花盆表情變開心 + 植物成長抖動 + 成長音效
3. t=1.0s：星星和愛心粒子噴發
4. t=1.5s：「+N 點」浮動文字
5. t=2.5s：動畫結束

### 5.3 階段提升動畫

1. t=0s：白光閃爍 + 階段提升音效
2. t=0.2s：彩虹紙花粒子爆發
3. t=0.5s：花盆表情變驚喜 + 植物變形
4. t=1.0s：背景漸變切換
5. t=1.5s：「等級提升！Lv N」浮動文字
6. t=3.0s：恢復正常

---

## 6. 影響範圍

### 需要修改的檔案

| 檔案 | 變更 |
|------|------|
| `SpriteKit/PlantNode.swift` | 全面重繪所有階段造型為可愛卡通風 |
| `SpriteKit/GroundNode.swift` | 重繪為圓潤草地 + 小花裝飾 |
| `SpriteKit/BackgroundNode.swift` | 改為夢幻漸層 + 雲朵/光點裝飾 |
| `SpriteKit/ParticleEffects.swift` | 新增愛心、星星、蝴蝶、紙花等粒子 |
| `SpriteKit/SproutScene.swift` | 新增觸碰互動、表情系統、說話泡泡、音效觸發 |
| `Views/SproutTabView.swift` | UI 可愛化改版 |
| `Views/AddTransactionView.swift` | 更新迷你場景動畫 |

### 需要新增的檔案

| 檔案 | 用途 |
|------|------|
| `SpriteKit/PotNode.swift` | 可愛花盆 + 表情系統 |
| `Services/AudioService.swift` | 音效與音樂引擎 |

### 不變的部分

- `Models/SproutPlant.swift` — 資料模型不變
- `Models/HarvestRecord.swift` — 資料模型不變
- `Services/SproutGrowthService.swift` — 成長邏輯不變
- `Views/HarvestGalleryView.swift` — 收成圖鑑不變（可選擇性美化）

---

## 7. 設計原則

- 保持「全程式碼繪製」風格，不引入外部圖片資源
- 保持「無外部套件依賴」原則，音效用 AVAudioEngine 程式合成
- 資料模型和成長邏輯完全不動，只改視覺和互動層
- 色彩方案與品牌綠色互補，但更夢幻柔和
